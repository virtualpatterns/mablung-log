{"version":3,"sources":["../../../source/library/log/formatted-log.js"],"names":["Clone","Configuration","Luxon","Utilities","Is","Log","DateTime","MILLISECONDS_PER_NANOSECOND","FormattedLog","constructor","parameter","defaultOption","getPrettifier","bind","merge","prettifierOption","option","data","format","nestedData","nestedKey","time","hostname","pid","level","messageKey","v","string","formatDateTime","formatComputerName","formatLevelName","duration","formatDuration","stack","not","emptyObject","formatInspect","inspect","dateTime","fromMillis","toFormat","longName","pattern","match","null","exec","shortName","levelNumber","getLevelName","toUpperCase","padStart","durationInNanoseconds"],"mappings":"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","sourcesContent":["import Clone from 'clone'\nimport { Configuration } from '@virtualpatterns/mablung-configuration'\nimport Luxon from 'luxon'\nimport Utilities from 'util'\nimport Is from '@pwn/is'\n\nimport { Log } from '../log.js'\n\nconst { DateTime } = Luxon\n\nconst MILLISECONDS_PER_NANOSECOND = 1000000\n\nclass FormattedLog extends Log {\n\n  constructor(...parameter) {\n    super(...parameter)\n  }\n\n  get defaultOption() {\n\n    let defaultOption = { \n      'prettyPrint': { \n        'inspect': { \n          'depth': null, \n          'maxArrayLength': null, \n          'showHidden': true \n        }\n      }, \n      'prettifier': this.getPrettifier.bind(this) \n    }\n\n    return Configuration.merge(super.defaultOption, defaultOption)\n\n  }\n\n  getPrettifier(prettifierOption) {\n    // return this.format.bind(this, prettifierOption)\n    return (function (option, data) { return this.format(data, option) }).bind(this, prettifierOption)\n  }\n\n  format(data, option) {\n\n    let nestedData = null\n\n    if (option.nestedKey) {\n      nestedData = data[option.nestedKey]\n    } else {\n\n      nestedData = Clone(data)\n\n      delete nestedData.time\n      delete nestedData.hostname\n      delete nestedData.pid\n      delete nestedData.level\n      delete nestedData[option.messageKey || 'msg']\n      delete nestedData.v\n\n    }\n\n    let string = ''\n    string += Utilities.format(\n      '%s %s %s %s %s%s',\n      this.formatDateTime(data.time),\n      this.formatComputerName(data.hostname),\n      data.pid,\n      this.formatLevelName(data.level),\n      data[option.messageKey || 'msg'] || '',\n      nestedData.duration ? ` in ${this.formatDuration(nestedData.duration)}` : '')\n\n    if (data.stack) {\n      string += `\\n\\n${data.stack}\\n\\n`\n    } else {\n      \n      delete nestedData.duration\n\n      if (Is.not.emptyObject(nestedData)) {\n        string += `\\n\\n${this.formatInspect(nestedData, option.inspect)}\\n\\n`\n      }\n      else {\n        string += '\\n'\n      }\n\n    }\n\n    return string\n  \n  }\n\n  formatDateTime(dateTime) {\n    return DateTime.fromMillis(dateTime).toFormat('yyyy.LL.dd-HH:mm:ss.SSSZZZ')\n  }\n\n  formatComputerName(longName) {\n\n    let pattern = /^(.+)\\./i\n    let match = null\n\n    if (Is.not.null(match = pattern.exec(longName))) {\n      let [ , shortName ] = match\n      return shortName\n    }\n\n    return longName\n\n  }\n  \n  formatLevelName(levelNumber) {\n    return this.getLevelName(levelNumber).toUpperCase().padStart(5)\n  }\n\n  formatDuration(durationInNanoseconds) {\n    return `${durationInNanoseconds / MILLISECONDS_PER_NANOSECOND}ms`\n  }\n\n  formatInspect(data, option) {\n    return Utilities.inspect(data, option)\n  }\n\n}\n\nexport { FormattedLog }\n"],"file":"formatted-log.js"}