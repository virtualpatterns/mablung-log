{"version":3,"sources":["../../../source/test/library/log-parameter.test.js"],"names":["FileSystem","Path","Stream","Test","Log","LogParameter","LogDestination","before","test","context","logPath","ensureDir","dirname","log","destination","option","getConstructorParameter","assert","deepEqual","path","stream","createWriteStream","Writable","Promise","resolve","reject","end","error","remove","after","always"],"mappings":"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","sourcesContent":["import { FileSystem } from '@virtualpatterns/mablung-file-system'\nimport Path from 'path'\nimport Stream from 'stream'\nimport Test from 'ava'\n\nimport { Log/*, FormattedLog */ } from '../../index.js'\nimport { LogParameter } from '../../library/log-parameter.js'\nimport { LogDestination } from '../../library/log-destination.js'\n\nTest.before(async (test) => {\n\n  test.context.logPath = 'process/log/log-parameter.log'\n  await FileSystem.ensureDir(Path.dirname(test.context.logPath))\n\n  test.context.log = new Log(test.context.logPath, { 'level': 'trace' })\n\n})\n\nTest('LogParameter.getConstructorParameter(log)', (test) => {\n\n  let [ destination, option ] = LogParameter.getConstructorParameter(test.context.log)\n\n  test.assert(destination instanceof LogDestination)\n  test.deepEqual(option, {})\n\n})\n\nTest('LogParameter.getConstructorParameter(log, destination)', (test) => {\n\n  let [ destination, option ] = LogParameter.getConstructorParameter(test.context.log, new LogDestination())\n\n  test.assert(destination instanceof LogDestination)\n  test.deepEqual(option, {})\n\n})\n\nTest('LogParameter.getConstructorParameter(log, stream)', async (test) => {\n\n  let path = 'process/log/log-parameter-stream-writable.log'\n  let stream = FileSystem.createWriteStream(path, { 'encoding': 'utf8', 'flags': 'a+' })\n\n  try {\n\n    let [ destination, option ] = LogParameter.getConstructorParameter(test.context.log, stream)\n\n    test.assert(destination instanceof Stream.Writable)\n    test.deepEqual(option, {})\n  \n  } finally {\n\n    await new Promise((resolve, reject) => {\n      stream.end((error) => {\n        if (error) {\n          reject(error)\n        } else {\n          resolve()\n        }\n      })\n    })\n\n    await FileSystem.remove(path)\n\n  }\n\n})\n\nTest('LogParameter.getConstructorParameter(log, path)', async (test) => {\n\n  let path = 'process/log/log-parameter-string.log'\n  let [ destination, option ] = LogParameter.getConstructorParameter(test.context.log, path)\n\n  try {\n    test.assert(destination instanceof LogDestination)\n    test.deepEqual(option, {})\n  } finally {\n    await FileSystem.remove(path)\n  }\n\n})\n\nTest('LogParameter.getConstructorParameter(log, option)', (test) => {\n\n  let [ destination, option ] = LogParameter.getConstructorParameter(test.context.log, { 'abc': 123 })\n\n  test.assert(destination instanceof LogDestination)\n  test.deepEqual(option, { 'abc': 123 })\n\n})\n\nTest('LogParameter.getConstructorParameter(log, destination, option)', (test) => {\n\n  let [ destination, option ] = LogParameter.getConstructorParameter(test.context.log, new LogDestination(), { 'abc': 123 })\n\n  test.assert(destination instanceof LogDestination)\n  test.deepEqual(option, { 'abc': 123 })\n\n})\n\nTest('LogParameter.getConstructorParameter(log, stream, option)', async (test) => {\n\n  let path = 'process/log/log-parameter-stream-writable.log'\n  let stream = FileSystem.createWriteStream(path, { 'encoding': 'utf8', 'flags': 'a+' })\n\n  try {\n\n    let [ destination, option ] = LogParameter.getConstructorParameter(test.context.log, stream, { 'abc': 123 })\n\n    test.assert(destination instanceof Stream.Writable)\n    test.deepEqual(option, { 'abc': 123 })\n  \n  } finally {\n\n    await new Promise((resolve, reject) => {\n      stream.end((error) => {\n        if (error) {\n          reject(error)\n        } else {\n          resolve()\n        }\n      })\n    })\n\n    await FileSystem.remove(path)\n\n  }\n\n})\n\nTest('LogParameter.getConstructorParameter(log, path, option)', (test) => {\n\n  let [ destination, option ] = LogParameter.getConstructorParameter(test.context.log, 'process/log/log-parameter-string.log', { 'abc': 123 })\n\n  test.assert(destination instanceof LogDestination)\n  test.deepEqual(option, { 'abc': 123 })\n\n})\n\nTest.after.always(async (test) => {\n\n  delete test.context.log\n\n  await FileSystem.remove(test.context.logPath)\n  delete test.context.logPath\n\n})\n\n"],"file":"log-parameter.test.js"}